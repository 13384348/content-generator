ğŸš€ é˜¿é‡Œäº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡ä»¤

è¯·åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ç»ˆç«¯ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

1ï¸âƒ£ åœæ­¢å½“å‰åº”ç”¨
pkill -f "node.*server.js"
pkill -f "node.*backend"

2ï¸âƒ£ æ¸…ç†å¹¶é‡æ–°åˆ›å»ºç›®å½•
rm -rf /opt/content-generator
mkdir -p /opt/content-generator
cd /opt/content-generator

3ï¸âƒ£ åˆ›å»ºæœåŠ¡å™¨æ–‡ä»¶
cat > server.js << 'EOF'
const express = require('express');
const path = require('path');
const cors = require('cors');

const app = express();
const PORT = process.env.PORT || 5004;

app.use(cors({
  origin: ['http://localhost:3000', 'http://8.154.36.16', 'http://mengtaiqi168.com'],
  credentials: true
}));

app.use(express.json());
app.use(express.static(path.join(__dirname, 'dist')));

app.get('/api/health', (req, res) => {
  res.json({
    status: 'healthy',
    timestamp: new Date().toISOString(),
    uptime: process.uptime()
  });
});

app.post('/api/auth/login', (req, res) => {
  res.json({
    success: true,
    message: 'ç™»å½•æˆåŠŸ',
    user: { id: 1, username: 'test' }
  });
});

app.post('/api/content/generate', (req, res) => {
  const { type, input } = req.body;
  setTimeout(() => {
    res.json({
      success: true,
      data: {
        type,
        input,
        output: `AIç”Ÿæˆçš„${type}å†…å®¹: ${input}`,
        timestamp: new Date().toISOString()
      }
    });
  }, 2000);
});

app.get('/api/history', (req, res) => {
  res.json({
    success: true,
    data: [
      {
        id: 1,
        title: 'ç¤ºä¾‹å†…å®¹',
        type: 'å†…å®¹ç”Ÿæˆ',
        created_at: new Date().toISOString()
      }
    ]
  });
});

app.get('*', (req, res) => {
  res.sendFile(path.join(__dirname, 'dist', 'index.html'));
});

app.listen(PORT, () => {
  console.log(`ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ ${PORT}`);
});
EOF

4ï¸âƒ£ åˆ›å»ºpackage.json
cat > package.json << 'EOF'
{
  "name": "content-generator-server",
  "version": "1.0.0",
  "main": "server.js",
  "scripts": {
    "start": "node server.js"
  },
  "dependencies": {
    "express": "^4.19.2",
    "cors": "^2.8.5"
  }
}
EOF

5ï¸âƒ£ å®‰è£…ä¾èµ–
npm install

6ï¸âƒ£ åˆ›å»ºå‰ç«¯ç›®å½•å¹¶æ·»åŠ æµ‹è¯•æ–‡ä»¶
mkdir -p dist
cat > dist/index.html << 'EOF'
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†…å®¹ç”Ÿæˆå™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #ffffff !important;
            color: #1a1a1a !important;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        h1 { color: #667eea; }
        .status {
            padding: 20px;
            background: #f0f0f0;
            border-radius: 8px;
            margin: 20px 0;
        }
        .btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– AIå†…å®¹ç”Ÿæˆå™¨</h1>
        <div class="status">
            <p>âœ… åº”ç”¨å·²æˆåŠŸéƒ¨ç½²</p>
            <p>ğŸ“± æ‰‹æœºç«¯å·²ä¿®å¤ç™½è‰²èƒŒæ™¯</p>
            <p>ğŸ”§ åŠŸèƒ½æ­£åœ¨å®Œå–„ä¸­</p>
        </div>
        <button class="btn" onclick="testAPI()">æµ‹è¯•API</button>
        <div id="result"></div>
    </div>

    <script>
        function testAPI() {
            fetch('/api/health')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('result').innerHTML =
                        '<div class="status">APIæµ‹è¯•æˆåŠŸ: ' + JSON.stringify(data) + '</div>';
                })
                .catch(err => {
                    document.getElementById('result').innerHTML =
                        '<div class="status">APIæµ‹è¯•å¤±è´¥: ' + err.message + '</div>';
                });
        }
    </script>
</body>
</html>
EOF

7ï¸âƒ£ å¯åŠ¨åº”ç”¨
nohup node server.js > app.log 2>&1 &

8ï¸âƒ£ éªŒè¯éƒ¨ç½²
echo "ç­‰å¾…åº”ç”¨å¯åŠ¨..."
sleep 5
curl http://localhost:5004/api/health

æ‰§è¡Œå®Œæˆåï¼Œè®¿é—® http://8.154.36.16 æŸ¥çœ‹æ•ˆæœï¼